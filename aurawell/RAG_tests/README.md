# RAG 测试套件

这个文件夹包含了 RAGExtension 模块的完整测试套件，用于验证 RAG（检索增强生成）系统的各个功能组件。

## 📁 文件结构

```
RAG_tests/
├── README.md                          # 本说明文件
├── api_test.py                        # 阿里云 DocMind API 测试
├── debug_test.py                      # 基础功能调试测试
├── simple_test.py                     # 导入和初始化测试
├── test_retrieval.py                  # 用户查询检索功能测试
├── test_reference_detection.py       # 文献引用检测功能测试
├── test_analysis.py                   # 检索质量分析测试
├── test_filtered_vectorization.py    # 过滤引用后的向量化测试
├── test_complete_workflow.py         # 完整工作流程测试
└── migrate_remaining_tests.py        # 测试文件迁移脚本
```

## 🚀 快速开始

### 前置条件

1. 确保已安装所有必要的依赖包
2. 确保 `.env` 文件包含正确的 API 密钥
3. 确保 `../rag/testMaterial/` 目录下有测试文档

### 运行测试

从 `RAG_tests` 目录运行以下命令：

```bash
# 基础功能测试
python simple_test.py          # 测试导入和初始化
python debug_test.py           # 测试文件类型检测和环境变量

# API 功能测试
python api_test.py             # 测试阿里云 DocMind API

# 核心功能测试
python test_reference_detection.py    # 测试引用检测功能
python test_filtered_vectorization.py # 测试过滤向量化功能
python test_retrieval.py             # 测试检索功能

# 综合测试
python test_analysis.py              # 检索质量分析
python test_complete_workflow.py     # 完整工作流程测试
```

## 📋 测试说明

### 1. 基础测试

#### `simple_test.py`
- **目的**: 验证所有依赖包是否正确安装
- **测试内容**: 导入测试、Document 类初始化
- **预期结果**: 所有导入成功，无错误

#### `debug_test.py`
- **目的**: 测试基础工具函数
- **测试内容**: 文件类型检测、环境变量加载
- **预期结果**: 正确识别 PDF 文件类型，成功加载环境变量

#### `api_test.py`
- **目的**: 测试阿里云 DocMind API 连接
- **测试内容**: API 认证、文档解析请求
- **预期结果**: 成功获取 Job ID

### 2. 核心功能测试

#### `test_reference_detection.py`
- **目的**: 验证文献引用检测功能
- **测试内容**: 
  - 各种引用格式识别（中文期刊、英文期刊、DOI、ISBN等）
  - 非引用内容识别
  - 真实文档引用过滤效果
- **预期结果**: 检测准确率 ≥ 90%

#### `test_filtered_vectorization.py`
- **目的**: 测试过滤引用后的向量化功能
- **测试内容**:
  - 文档解析和向量化
  - 引用内容过滤效果
  - 向量化结果质量
- **预期结果**: 无引用内容残留，向量化成功

#### `test_retrieval.py`
- **目的**: 测试用户查询检索功能
- **测试内容**:
  - 三个测试查询的检索结果
  - 检索速度和质量
- **预期结果**: 检索到相关内容，响应时间合理

### 3. 综合测试

#### `test_analysis.py`
- **目的**: 分析检索结果质量
- **测试内容**:
  - 关键词匹配率分析
  - 相关性评分
  - 响应时间统计
- **预期结果**: 提供详细的质量分析报告

#### `test_complete_workflow.py`
- **目的**: 测试完整的 RAG 工作流程
- **测试内容**:
  - 文档上传和向量化
  - 用户查询检索
  - 系统性能评估
- **预期结果**: 完整流程正常运行，性能指标达标

## 📊 性能指标

### 预期性能标准

- **查询速度**: 
  - 优秀: < 3秒
  - 良好: 3-6秒
  - 需要优化: > 6秒

- **内容质量**:
  - 优秀: ≥ 80% 有效内容
  - 良好: 60-80% 有效内容
  - 需要改进: < 60% 有效内容

- **引用过滤**:
  - 优秀: < 10% 引用内容
  - 良好: 10-20% 引用内容
  - 需要改进: > 20% 引用内容

## 🔧 故障排除

### 常见问题

1. **导入错误**
   - 检查是否在 `RAG_tests` 目录下运行
   - 确认 `../rag/` 目录存在且包含必要文件

2. **API 连接失败**
   - 检查 `.env` 文件中的 API 密钥
   - 确认网络连接正常

3. **文件路径错误**
   - 确认 `../rag/testMaterial/` 目录存在
   - 检查测试文档是否存在

4. **向量数据库连接失败**
   - 检查 DashVector API 密钥
   - 确认向量数据库集合已创建

## 📝 测试报告

每个测试都会生成详细的输出报告，包括：
- ✅ 成功的测试项目
- ❌ 失败的测试项目
- 📊 性能统计数据
- 🎯 质量分析结果

## 🔄 持续集成

建议在以下情况下运行完整测试套件：
- 修改 RAGExtension 核心代码后
- 更新依赖包后
- 部署到新环境前
- 定期性能检查

## 📞 支持

如果遇到问题，请检查：
1. 所有依赖是否正确安装
2. 环境变量是否正确配置
3. 测试文档是否存在
4. 网络连接是否正常
