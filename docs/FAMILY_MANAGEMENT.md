# 家庭多用户健康管理功能

## 📋 功能概述

AuraWell 新增了完整的家庭多用户健康管理功能，支持"主账号 + 家庭成员"架构，让家庭成员能够协同管理健康数据，共同参与健康挑战，并享受个性化的健康建议。

## 🏗️ 架构设计

### 用户角色体系
- **Owner (拥有者)**: 家庭创建者，拥有所有权限
- **Manager (管理员)**: 可以管理成员、设置告警、创建挑战
- **Member (普通成员)**: 可以查看自己的数据，参与挑战

### 权限控制系统
- **基础权限**: 查看自己数据、编辑自己数据、查看家庭摘要、参与挑战
- **管理权限**: 查看所有数据、邀请成员、管理成员、设置告警、创建挑战、导出报告
- **告警权限**: 接收健康告警、接收紧急告警、管理告警设置

## 🚀 核心功能

### 1. 成员管理
- **创建家庭**: 用户可以创建家庭并成为拥有者
- **邀请成员**: 通过邮箱邀请家庭成员加入
- **角色分配**: 为成员分配不同的角色和权限
- **成员切换**: 在不同成员间切换，为特定成员生成健康建议

### 2. 活跃成员系统
- **成员切换器**: 前端下拉菜单，可快速切换活跃成员
- **上下文注入**: 后端将 member_id 注入 LangChain Prompt
- **个性化建议**: 基于活跃成员的数据生成专属健康计划

### 3. 健康告警机制
- **指标监测**: 监测体重、心率、睡眠、步数等关键指标
- **阈值设置**: 可自定义各项健康指标的告警阈值
- **多渠道通知**: 支持微信、短信等多种告警方式
- **权限控制**: 只有有权限的人员才能接收告警

### 4. 家庭仪表盘
- **健康对比**: 显示各成员健康数据对比图
- **排行榜**: 步数、卡路里、睡眠等指标排行
- **成就系统**: 家庭成员互相点赞、成就展示
- **挑战系统**: 家庭步数挑战、减重挑战等

### 5. 互动功能
- **点赞系统**: 成员间可以互相点赞鼓励
- **家庭挑战**: 创建和参与家庭健康挑战
- **进度分享**: 分享健康进度和成就
- **协同目标**: 设置家庭共同健康目标

## 🛠️ 技术实现

### 前端架构
```
frontend/src/
├── components/family/          # 家庭管理组件
│   ├── MemberSwitcher.vue     # 成员切换器
│   ├── MemberManagement.vue   # 成员管理
│   └── CreateChallengeForm.vue # 挑战创建表单
├── views/user/                # 家庭相关页面
│   ├── FamilyDashboard.vue    # 家庭仪表盘
│   ├── FamilyMembers.vue      # 成员管理页面
│   ├── MemberHealth.vue       # 成员健康数据
│   ├── FamilyChallenges.vue   # 家庭挑战
│   ├── FamilyAlerts.vue       # 健康告警
│   └── FamilySettings.vue     # 家庭设置
├── stores/family.js           # 家庭状态管理
└── api/family.js             # 家庭API接口
```

### 后端API
- **家庭管理**: 创建、查询、更新、删除家庭
- **成员管理**: 邀请、移除、权限管理
- **健康数据**: 成员健康数据查询和对比
- **告警系统**: 告警设置、触发、通知
- **挑战系统**: 挑战创建、参与、进度跟踪

### 状态管理
使用 Pinia 管理家庭相关状态：
- 当前家庭信息
- 活跃成员信息
- 家庭成员列表
- 权限信息
- 仪表盘数据

## 📱 用户界面

### 成员切换器
- 位置: 个人档案、健康计划等页面顶部
- 功能: 快速切换活跃成员
- 显示: 成员头像、姓名、角色标识
- 状态: 显示当前活跃成员

### 家庭仪表盘
- 统计卡片: 今日总步数、平均睡眠、活跃成员、本周挑战
- 排行榜: 支持按步数、卡路里、睡眠时长排序
- 挑战列表: 显示进行中的家庭挑战
- 健康对比: 成员间健康数据可视化对比

### 成员管理
- 成员列表: 显示所有家庭成员信息
- 权限管理: 为成员分配和修改权限
- 邀请功能: 通过邮箱邀请新成员
- 操作记录: 记录成员管理操作历史

## 🔒 安全与隐私

### 数据隔离
- 每个成员只能查看自己的详细数据
- 管理员可以查看所有成员的数据
- 数据访问基于角色权限控制

### 隐私设置
- 数据共享开关: 控制是否允许家庭成员查看彼此数据
- 活动可见性: 设置活动数据的可见范围
- 告警权限: 控制谁可以接收健康告警

### 权限验证
- 前端权限检查: 基于用户角色显示/隐藏功能
- 后端权限验证: API层面的权限验证
- 操作审计: 记录敏感操作日志

## 🚀 使用指南

### 创建家庭
1. 登录 AuraWell 系统
2. 进入家庭管理页面
3. 点击"创建家庭"按钮
4. 填写家庭名称和描述
5. 确认创建，自动成为家庭拥有者

### 邀请成员
1. 在家庭管理页面点击"邀请成员"
2. 输入成员邮箱地址
3. 选择成员角色（普通成员/管理员）
4. 添加邀请备注（可选）
5. 发送邀请，等待成员接受

### 切换活跃成员
1. 在支持的页面找到成员切换器
2. 点击下拉菜单查看所有成员
3. 选择要切换的成员
4. 系统自动切换上下文
5. 后续操作将基于选中成员

### 设置健康告警
1. 进入家庭设置页面
2. 找到"健康告警设置"部分
3. 开启需要的告警类型
4. 设置告警阈值
5. 配置通知方式

### 创建家庭挑战
1. 进入家庭挑战页面
2. 点击"创建挑战"按钮
3. 填写挑战信息（名称、描述、类型）
4. 设置目标值和时长
5. 选择参与成员
6. 创建并开始挑战

## 🔄 工作流程

### 健康建议生成流程
1. 用户在成员切换器中选择目标成员
2. 前端发送切换请求到后端
3. 后端更新用户会话中的活跃成员ID
4. 用户发起健康咨询请求
5. 后端将活跃成员ID注入LangChain Prompt
6. AI基于特定成员数据生成个性化建议
7. 返回针对该成员的专属健康计划

### 告警触发流程
1. 系统定期检查成员健康数据
2. 对比预设的告警阈值
3. 发现异常时触发告警
4. 根据权限设置确定通知对象
5. 通过多渠道发送告警通知
6. 记录告警历史和处理状态

## 📊 数据模型

### 家庭表 (families)
- family_id: 家庭唯一标识
- family_name: 家庭名称
- description: 家庭描述
- admin_id: 管理员用户ID
- created_at: 创建时间

### 成员表 (family_members)
- member_id: 成员唯一标识
- family_id: 所属家庭ID
- user_id: 用户ID
- role: 角色（Owner/Manager/Member）
- joined_at: 加入时间
- status: 状态（active/inactive）

### 权限表 (member_permissions)
- permission_id: 权限唯一标识
- member_id: 成员ID
- permission_type: 权限类型
- permission_value: 权限值

### 告警表 (health_alerts)
- alert_id: 告警唯一标识
- family_id: 家庭ID
- member_id: 成员ID
- alert_type: 告警类型
- threshold_value: 阈值
- current_value: 当前值
- status: 状态
- created_at: 创建时间

## 🎯 未来规划

### 短期目标
- [ ] 完善告警通知系统（微信、短信集成）
- [ ] 增加更多健康指标监测
- [ ] 优化家庭仪表盘数据可视化
- [ ] 添加家庭健康报告导出功能

### 中期目标
- [ ] 集成可穿戴设备数据
- [ ] 添加家庭医生咨询功能
- [ ] 实现健康数据AI分析
- [ ] 支持多语言国际化

### 长期目标
- [ ] 构建健康社区生态
- [ ] 集成第三方健康服务
- [ ] 开发移动端应用
- [ ] 实现跨平台数据同步

## 📞 技术支持

如有技术问题或功能建议，请联系：
- GitHub Issues: https://github.com/PrescottClub/AuraWell_Agent/issues
- 邮箱: support@aurawell.com
- 文档: http://127.0.0.1:8000/docs
